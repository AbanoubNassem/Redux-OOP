import _regeneratorRuntime from"@babel/runtime/regenerator";import _classCallCheck from"@babel/runtime/helpers/classCallCheck";import _createClass from"@babel/runtime/helpers/createClass";import _possibleConstructorReturn from"@babel/runtime/helpers/possibleConstructorReturn";import _getPrototypeOf from"@babel/runtime/helpers/getPrototypeOf";import _inherits from"@babel/runtime/helpers/inherits";import AsyncStorage from"@react-native-community/async-storage";import{ActionProvider}from"../../action-providers";import StorageActionTypes from"./action-types";import reducer from"./reducer";var PREFIX="REDUX_OOP_";export var RNAsyncStorageActions=function(_ActionProvider){_inherits(RNAsyncStorageActions,_ActionProvider);function RNAsyncStorageActions(){var _getPrototypeOf2;var _this;_classCallCheck(this,RNAsyncStorageActions);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn(this,(_getPrototypeOf2=_getPrototypeOf(RNAsyncStorageActions)).call.apply(_getPrototypeOf2,[this].concat(args)));_this.reducer=function(){return reducer;};return _this;}_createClass(RNAsyncStorageActions,[{key:"load",value:function load(){var storage,keys,stores;return _regeneratorRuntime.async(function load$(_context){while(1){switch(_context.prev=_context.next){case 0:storage={};_context.next=3;return _regeneratorRuntime.awrap(AsyncStorage.getAllKeys());case 3:keys=_context.sent;_context.next=6;return _regeneratorRuntime.awrap(AsyncStorage.multiGet(keys));case 6:stores=_context.sent;stores.map(function(_result,i,store){var key=store[i][0];if(key.startsWith(PREFIX)){var value=store[i][1];storage[key.substring(PREFIX.length)]=JSON.parse(value);storage[key];}});this.dispatchAction(StorageActionTypes.STORAGE_LOADED,storage);return _context.abrupt("return",storage);case 10:case"end":return _context.stop();}}},null,this);}},{key:"clear",value:function clear(){var storage;return _regeneratorRuntime.async(function clear$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:storage={};_context2.next=3;return _regeneratorRuntime.awrap(AsyncStorage.clear());case 3:this.dispatchAction(StorageActionTypes.STORAGE_CLEARED,storage);return _context2.abrupt("return",storage);case 5:case"end":return _context2.stop();}}},null,this);}},{key:"saveOrUpdate",value:function saveOrUpdate(object){var keys,index,key;return _regeneratorRuntime.async(function saveOrUpdate$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:keys=Object.keys(object);index=0;case 2:if(!(index<keys.length)){_context3.next=9;break;}key=keys[index];_context3.next=6;return _regeneratorRuntime.awrap(AsyncStorage.setItem(PREFIX+key,JSON.stringify(object[key])));case 6:index++;_context3.next=2;break;case 9:return _context3.abrupt("return",this.dispatchAction(StorageActionTypes.STORAGE_UPDATED,object));case 10:case"end":return _context3.stop();}}},null,this);}},{key:"remove",value:function remove(){var keys,deleted,_args5=arguments;return _regeneratorRuntime.async(function remove$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:keys=_args5.length>0&&_args5[0]!==undefined?_args5[0]:[];deleted={};if(!Array.isArray(keys)){_context5.next=6;break;}keys.forEach(function _callee(key){return _regeneratorRuntime.async(function _callee$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return _regeneratorRuntime.awrap(AsyncStorage.removeItem(PREFIX+key));case 2:deleted[key]="null";case 3:case"end":return _context4.stop();}}},null,this);});_context5.next=9;break;case 6:_context5.next=8;return _regeneratorRuntime.awrap(AsyncStorage.removeItem(PREFIX+keys));case 8:deleted[keys]="null";case 9:return _context5.abrupt("return",this.dispatchAction(StorageActionTypes.STORAGE_REMOVED,deleted));case 10:case"end":return _context5.stop();}}},null,this);}}]);return RNAsyncStorageActions;}(ActionProvider);
//# sourceMappingURL=rn-async-storage-actions.js.map